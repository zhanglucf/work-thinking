

# ä»€ä¹ˆæ˜¯redis?

> â€‹		Redis:REmote DIctionary Server(è¿œç¨‹å­—å…¸æœåŠ¡å™¨)
> æ˜¯å®Œå…¨å¼€æºå…è´¹çš„ï¼Œç”¨Cè¯­è¨€ç¼–å†™çš„ï¼Œéµå®ˆBSDåè®®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„(key/value)åˆ†å¸ƒå¼å†…å­˜æ•°æ®åº“ï¼ŒåŸºäºå†…å­˜è¿è¡Œ
> å¹¶æ”¯æŒæŒä¹…åŒ–çš„NoSQLæ•°æ®åº“ï¼Œæ˜¯å½“å‰æœ€çƒ­é—¨çš„NoSqlæ•°æ®åº“ä¹‹ä¸€,ä¹Ÿè¢«äººä»¬ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨ã€‚



# redisçš„ä¸‰ä¸ªç‰¹ç‚¹

>  - [x] Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨
>   - [x] Redisä¸ä»…ä»…æ”¯æŒç®€å•çš„key-valueç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›listï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨
>   - [x] Redisæ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³master-slaveæ¨¡å¼çš„æ•°æ®å¤‡ä»½



# Redisçš„äº”å¤§æ•°æ®ç±»å‹ï¼š

>:one:**stringï¼ˆå­—ç¬¦ä¸²ï¼‰**
>
> - [x] stringæ˜¯redisæœ€åŸºæœ¬çš„ç±»å‹ï¼Œä½ å¯ä»¥ç†è§£æˆä¸Memcachedä¸€æ¨¡ä¸€æ ·çš„ç±»å‹ï¼Œä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueã€‚
>
> - [x] stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚**æ„æ€æ˜¯redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ ã€‚**
>
> - [x] stringç±»å‹æ˜¯Redisæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œ**==ä¸€ä¸ªredisä¸­å­—ç¬¦ä¸²valueæœ€å¤šå¯ä»¥æ˜¯512M==**
>
>:one:hashï¼ˆå“ˆå¸Œï¼Œç±»ä¼¼javaé‡Œçš„Mapï¼‰**
>
> - [x] Redis hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚ç±»ä¼¼Javaé‡Œé¢çš„Map
>
>:two:**listï¼ˆåˆ—è¡¨ï¼‰**
>
> - [x] Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ å¯¼åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚
>   å®ƒçš„åº•å±‚å®é™…æ˜¯ä¸ªé“¾è¡¨
>
>:three:**setï¼ˆé›†åˆï¼‰**
>
> - [x] Redisçš„Setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚å®ƒæ˜¯é€šè¿‡HashTableå®ç°å®ç°çš„ï¼Œ
>
>:four:**zset(sorted setï¼šæœ‰åºé›†åˆ)**
>
> - [x] Redis zset å’Œ set ä¸€æ ·ä¹Ÿæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆ,ä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚ ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ† æ•°ã€‚ redisæ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚zsetçš„æˆå‘˜æ˜¯å”¯ä¸€çš„,ä½†åˆ†æ•°(score)å´å¯ä»¥é‡å¤ã€‚
>



# Reidsæ•°æ®æŒä¹…åŒ–æ–¹å¼æœ‰å“ªäº›ï¼Ÿ

> :one:RDB
>
> :two:AOF



# è¯·ä½ ä»‹ç»ä¸‹RDBä¸AOF



> - ==**RDBï¼ˆRedis DataBaseï¼‰**==
>
>   > â€‹		RDBæŒä¹…åŒ–æ˜¯æŒ‡åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ã€‚
>   >
>   > ä¹Ÿæ˜¯é»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ï¼Œè¿™ç§æ–¹å¼æ˜¯å°±æ˜¯å°†å†…å­˜ä¸­æ•°æ®ä»¥å¿«ç…§çš„æ–¹å¼å†™å…¥åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­,é»˜è®¤çš„æ–‡ä»¶åä¸º**dump.rdb**ã€‚
>
>   è¿‡ç¨‹ï¼š
>
>   > ğŸ“— åœ¨æˆ‘ä»¬å®‰è£…äº†redisä¹‹åï¼Œæ‰€æœ‰çš„é…ç½®éƒ½æ˜¯åœ¨redis.confæ–‡ä»¶ä¸­ï¼Œé‡Œé¢ä¿å­˜äº†RDBå’ŒAOFä¸¤ç§æŒä¹…åŒ–æœºåˆ¶çš„å„ç§é…ç½®ã€‚
>
>   è§¦å‘RDBæœºåˆ¶çš„ä¸‰ç§æ–¹å¼æ˜¯ä»€ä¹ˆï¼Œç®€å•ä»‹ç»ä¸‹ã€‚
>
>   > 1. saveæ–¹å¼ï¼Œè¯¥å‘½ä»¤ä¼šé˜»å¡å½“å‰RedisæœåŠ¡å™¨ï¼Œæ‰§è¡Œsaveå‘½ä»¤æœŸé—´ï¼ŒRedisä¸èƒ½å¤„ç†å…¶ä»–å‘½ä»¤ï¼Œç›´åˆ°RDBè¿‡ç¨‹å®Œæˆä¸ºæ­¢
>   >
>   > 2. bgsaveæ–¹å¼ï¼Œæ‰§è¡Œè¯¥å‘½ä»¤æ—¶ï¼ŒRedisä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œå¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚
>   >
>   > 3. è‡ªåŠ¨è§¦å‘ï¼Œè‡ªåŠ¨è§¦å‘æ˜¯ç”±æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶æ¥å®Œæˆçš„ã€‚å…·ä½“çš„é…ç½®åœ¨redis.confä¸­ã€‚
>
> - Redisä¼šå•ç‹¬forkä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ª**ä¸´æ—¶æ–‡ä»¶**ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶**æ›¿æ¢**ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½,å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£**RDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ çš„é«˜æ•ˆ**ã€‚RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚**rdb ä¿å­˜çš„æ˜¯dump.rdbæ–‡ä»¶**
>
> - ==**AOFï¼ˆAppend Only Fileï¼‰**==
>   
>   > â€‹		redisä¼šå°†æ¯ä¸€ä¸ªæ”¶åˆ°çš„å†™å‘½ä»¤éƒ½é€šè¿‡writeå‡½æ•°è¿½åŠ åˆ°æ–‡ä»¶ä¸­ã€‚é€šä¿—çš„ç†è§£å°±æ˜¯æ—¥å¿—è®°å½•ã€‚AOF ï¼šRedis é»˜è®¤ä¸å¼€å¯ã€‚
>   
>   AOFæ–‡ä»¶é‡å†™åŸç†ï¼Ÿ
>   
>   >â€‹		æŒä¹…åŒ–æ–‡ä»¶ä¼šå˜çš„è¶Šæ¥è¶Šå¤§ã€‚ä¸ºäº†å‹ç¼©aofçš„æŒä¹…åŒ–æ–‡ä»¶ã€‚redisæä¾›äº†bgrewriteaofå‘½ä»¤ã€‚å°†å†…å­˜ä¸­çš„æ•°æ®ä»¥å‘½ä»¤çš„æ–¹å¼ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶ä¼šforkå‡ºä¸€æ¡æ–°è¿›ç¨‹æ¥å°†æ–‡ä»¶é‡å†™ã€‚é‡å†™aofæ–‡ä»¶çš„æ“ä½œï¼Œ==å¹¶æ²¡æœ‰è¯»å–æ—§çš„aofæ–‡ä»¶==ï¼Œè€Œæ˜¯å°†æ•´ä¸ªå†…å­˜ä¸­çš„æ•°æ®åº“å†…å®¹ç”¨å‘½ä»¤çš„æ–¹å¼é‡å†™äº†ä¸€ä¸ªæ–°çš„aofæ–‡ä»¶ï¼Œè¿™ç‚¹å’Œå¿«ç…§æœ‰ç‚¹ç±»ä¼¼ã€‚
>   
>   AOFçš„è§¦å‘æœºåˆ¶ï¼Ÿ
>   
>   >1. æ¯ä¿®æ”¹åŒæ­¥alwaysï¼šåŒæ­¥æŒä¹…åŒ– æ¯æ¬¡å‘ç”Ÿæ•°æ®å˜æ›´ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜ æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½
>   >
>   >2. æ¯ç§’åŒæ­¥everysecï¼šå¼‚æ­¥æ“ä½œï¼Œæ¯ç§’è®°å½• å¦‚æœä¸€ç§’å†…å®•æœºï¼Œæœ‰æ•°æ®ä¸¢å¤±



# é»˜è®¤AOFæ–¹å¼æ˜¯å¼€å¯è¿˜æ˜¯å…³é—­?

> å…³é—­



# å¦‚ä½•å¼€å¯AOFï¼Ÿ

>ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œä¸ºyes



# ä¸¤ç§æŒä¹…åŒ–æ–¹å¼æ˜¯å¦èƒ½å¤ŸåŒæ—¶å¼€å¯ï¼Ÿ

> å¯ä»¥
> RDBçš„æ•°æ®ä¸å®æ—¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤è€…æ—¶æœåŠ¡å™¨é‡å¯ä¹Ÿåªä¼šæ‰¾AOFæ–‡ä»¶ã€‚



# é‚£è¦ä¸è¦åªä½¿ç”¨AOFå‘¢ï¼Ÿ

> ä½œè€…å»ºè®®ä¸è¦ï¼Œå› ä¸ºRDBæ›´é€‚åˆç”¨äºå¤‡ä»½æ•°æ®åº“(AOFåœ¨ä¸æ–­å˜åŒ–ä¸å¥½å¤‡ä»½)ï¼Œå¿«é€Ÿé‡å¯ï¼Œè€Œä¸”ä¸ä¼šæœ‰AOFå¯èƒ½æ½œåœ¨çš„bugï¼Œç•™ç€ä½œä¸ºä¸€ä¸ªä¸‡ä¸€çš„æ‰‹æ®µã€‚



# Redisçš„å¤åˆ¶(Master/Slave)  ,èƒ½å¹²å˜›ï¼Ÿ

> 1. é¿å…rediså•ç‚¹æ•…éšœ
> 2. æ„å»ºè¯»å†™åˆ†ç¦»æ¶æ„ï¼Œæ»¡è¶³è¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯
> 3. å®¹ç¾æ¢å¤



# Redisä¸»ä»æ•°æ®å¤åˆ¶è¿‡ç¨‹ï¼š

>1. å½“ä»åº“ä¸ä¸»åº“å»ºç«‹ä¸»ä»å…³ç³»åï¼Œä¼šå‘ä¸»åº“å‘é€SYNCå‘½ä»¤ï¼Œè¯·æ±‚åŒæ­¥ä¸»åº“æ•°æ®ï¼›
>
>2. ä¸»åº“æ¥æ”¶åˆ°SYNCå‘½ä»¤ï¼Œå¼€å§‹åœ¨åå°ä¿å­˜å¿«ç…§æ•°æ®ï¼ˆRDBæŒä¹…åŒ–è¿‡ç¨‹ï¼‰ï¼Œå¹¶å°†å…¶æ¥æ”¶åˆ°çš„å†™å‘½ä»¤å†™å…¥ç¼“å­˜ã€‚
>
>3. å½“å¿«ç…§å®Œæˆåï¼Œä¸»åº“Redisä¼šå°†å¿«ç…§æ–‡ä»¶å’Œæ‰€æœ‰ç¼“å­˜çš„å†™å‘½ä»¤å‘é€ç»™ä»åº“ã€‚
>
>4. ä»åº“Redisæ¥æ”¶åˆ°å‘½ä»¤åï¼Œä¼šè½½å…¥å¿«ç…§æ–‡ä»¶å¹¶æ‰§è¡Œæ”¶åˆ°çš„ç¼“å­˜å‘½ä»¤ã€‚
>
>5. ç„¶åï¼Œä¸»åº“æ¯æ”¶åˆ°å†™å‘½ä»¤æ—¶å°±ä¼šå°†å‘½ä»¤å‘é€ç»™ä»åº“Redisï¼Œä»è€Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚
>
>![img](../images/525035-20191129153938103-179159399.png)



 -  # **å“¨å…µæ¨¡å¼(sentinel)**
	
	èƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“
	
	
	
	# å¦‚æœä¹‹å‰çš„masteré‡å¯å›æ¥ï¼Œä¼šä¸ä¼šåŒmasterå†²çªï¼Ÿ
	
	> ä¸ä¼šï¼Œmasteré‡å¯å›æ¥ä¼šæˆä¸ºslave
	
	