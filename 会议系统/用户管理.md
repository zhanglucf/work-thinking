##### 1、获取`accessToken`或使用`refreshtoken`刷新`accessToken`

```apl
POST localhost:8088/userserviceth/oauth/token
```

1.1、获取`token` 参数示例

```json
{
    "userName":"security1",
    "pwd":56789
}
```

1.2、根据`refreshToken`刷新`accessToken `参数示例

```json
{
"refreshToken": "eyJhbGciOiJSUzI1NiJ9.eyJkZXB0TmFtZSI6bnVsbCwic3ViIjoiMDAwMDAwMDAwMDIiLCJyb2xlSWQiOjY3ODEyODExOTkyNTI4MzIyNTgsImRlcHRJZCI6bnVsbCwicGhvdG8iOm51bGwsInVzZXJOYW1lIjoiYXVkaXRvcjEiLCJwaG9uZSI6IjAwMDAwMDAwMDAyIiwicm9sZUZsYWciOjMsIm5hbWUiOiLlrqHorqHlkZgxIiwiaWQiOjY3ODE3MDQ0ODgzNjYzNzQ5MTIsImV4cCI6MTYxNzU5MTM1MywiaWF0IjoxNjE2OTg2NTUzLCJqdGkiOiIzZDk5YWU4Yy01MDVlLTQ2NmMtYmVhMi03NzQyNjc4YWM4ZGIifQ.gxKT8HOwmeULlo2DyaFajxbnSXdrn4f3xgTSGXXdiKXoBxfImiIITp32x4RxBTAn_gk_tyQCSEGy95P1zzcXj0dz20abmWt2fxP2VtHeRfCZ5XabZbEOcwAm2Wi2vBwRG96StLtHuv_TnXa0WRqX4hrEBSsox9Wk_PEooW4EIrY",
"clientId":"hyxt-web",
"clientSecret":"a908d001c0c985a79d6d258312b99dbd",
"grantType":"refreshToken"
}
```

response

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "accessToken": "eyJhbGciOiJSUzI1NiJ9.eyJkZXB0TmFtZSI6bnVsbCwic3ViIjoiY2V0Y2Nsb3VkIiwicm9sZUlkIjo2NzgxMjgxMTk5MjUyODMyMjU3LCJkZXB0SWQiOm51bGwsInBob3RvIjpudWxsLCJ1c2VyTmFtZSI6InNlY3VyaXR5MSIsInBob25lIjoiMDAwMDAwMDAwMDEiLCJyb2xlRmxhZyI6MiwicHdkVmVyaWZ5Q29kZSI6NDEwMDEsIm5hbWUiOiLkv53lr4blkZgxIiwiaWQiOjY3ODE3MDQwMTI3ODY4MjcyNjYsImV4cCI6MTYxNzA2NTcyMiwiaWF0IjoxNjE3MDY1NjYyLCJqdGkiOiJlYjdmMmZhZC00OGY4LTQ0ZDYtODMyYy05ZDRjMWQ5YjVkYmMiLCJwd2RWZXJpZnlNc2ciOiLlr4bnoIHplb_luqbopoHmsYLoh7PlsJE55L2NIn0.IWfKZDnbW_-rlEXOgMammxHlDxwu--9DRx68MtAjJESLxU2xbMWmW45yITJEXd5-SILffuoKH6zsIgYM0ECB7T8qvw3AhXouTUb_ECpGi8wQpTPyhM2jL8ve3gxFUyj32Wt536uvEzJQ5yA6PNuHJ2Nltt-LKR-fTtJHQet6R3s",
        "exp": 60000,
        "refreshToken": "eyJhbGciOiJSUzI1NiJ9.eyJkZXB0TmFtZSI6bnVsbCwic3ViIjoiMDAwMDAwMDAwMDEiLCJyb2xlSWQiOjY3ODEyODExOTkyNTI4MzIyNTcsImRlcHRJZCI6bnVsbCwicGhvdG8iOm51bGwsInVzZXJOYW1lIjoic2VjdXJpdHkxIiwicGhvbmUiOiIwMDAwMDAwMDAwMSIsInJvbGVGbGFnIjoyLCJwd2RWZXJpZnlDb2RlIjo0MTAwMSwibmFtZSI6IuS_neWvhuWRmDEiLCJpZCI6Njc4MTcwNDAxMjc4NjgyNzI2NiwiZXhwIjoxNjE3MDY1NzgyLCJpYXQiOjE2MTcwNjU2NjIsImp0aSI6IjFmMDczMmQxLWI0MDMtNGUyMy1hMThiLTQxYjI1YmE4OGRmNCIsInB3ZFZlcmlmeU1zZyI6IuWvhueggemVv-W6puimgeaxguiHs-WwkTnkvY0ifQ.SgfQklVmbXfWR7n6c4mTa_nZP_Q2lMdTbHgVpzfqsVKC7ZmH-pcywZ1onaqCAGfR9Qvr6pv9crDQlh1tK6vE-N6JWvyTSQTDR_8Pi1ixxADKsWHjzlktSy41PzcrJp9Duk7cByRZ0dbNbjlpca4zOCVlWozbAEUG-lN4k6FDRoE"
    },
    "success": true,
    "errorCode": null
}
```

errorCode

| 50001 | 账号或者密码错误             |
| ----- | ---------------------------- |
| 50005 | 账号被锁定，请联系保密员解锁 |
| 40006 | refresh token过期            |
|       |                              |



##### 2、密码安全策列检查

```apl
GET localhost:8088/userservice/oauth/pwd
```

errorCode

| 41001 | 口令长度低于安全要求，需要修改口令   |
| ----- | ------------------------------------ |
| 41002 | 原始口令，需要及时修改口令           |
| 41003 | 口令使用超过指定时间，需要设置新口令 |
| 41004 | 口令被锁定，请联系保密员             |
| 41005 | 口令快过期提醒                       |
| -1    | 密码检查通过                         |



##### 3、userInfo

```apl
GET localhost:8088/userservice/user/info
```

response

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 6781705169693310977,
        "insertTime": "2021-03-28 15:54:58",
        "insertBy": null,
        "updateTime": "2021-03-28 15:21:45",
        "updateBy": null,
        "name": "会议管理员1",
        "sex": 0,
        "phone": "18134867117",
        "remark": null,
        "photo": null,
        "email": "",
        "deptId": null,
        "roleId": 6781281199257026560,
        "userName": "meeting_admin1",
        "pwdUpateTime": "2021-03-28 15:54:58",
        "pwdLocked": false,
        "filePrivilege": null,
        "code": null,
        "department": null,
        "roleName": "会议管理员",
        "roleFlag": 4,
        "filePrivilegeArray": null
    },
    "success": true,
    "errorCode": null
}
```

关于roleFlag

| 1    | 系统管理员 |
| ---- | ---------- |
| 2    | 保密员     |
| 3    | 审计员     |
| 4    | 会议管理员 |
| 5    | 普通用户   |



##### 4、获取安全策列配置

```apl
GET localhost:8088/userservice/oauth/security/policy
```

response

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 6781725798844858369,
        "insertTime": "2021-03-28 16:43:25",
        "insertBy": null,
        "updateTime": "2021-03-28 16:43:28",
        "updateBy": null,
        "defPwd": "111111",
        "pwdLength": 9,
        "tokenExp": 60000,
        "refreshTokenExp": 120000,
        "retryLimit": 6,
        "pwdValidTime": 2,
        "logValidTime": 1
    },
    "success": true,
    "errorCode": null
}
```

个别字段说明

| defPwd       | 重置口令                  |
| ------------ | ------------------------- |
| pwdLength    | 管理员口令长度 （位字符） |
| retryLimit   | 身份鉴别尝试次数 （次）   |
| pwdValidTime | 口令跟换周期  （天）      |
| logValidTime | 审计日志保存周期 （月）   |

##### 5、更新安全策列配置

```apl
PUT localhost:8088/userservice/oauth/security/policy
```

参数示例

```json
{
        "id": 6781725798844858369,
        "defPwd": "111111",
        "pwdLength": 9,
        "retryLimit": 6,
        "pwdValidTime": 2,
        "logValidTime": 1
    }
```

> 除id是非空字段，其余字段非必须

##### 6、重置密码

```apl
PUT localhost:8088/userservice/user/reset/password/{userId}
```



##### 7、更新用户信息

> 更新用户数据包括：
>
> ​	`系统管理员`更新`普通用户`和更新`会议管理员 ` 的用户名和邮箱
>
> ​	`保密员`更新`系统管理员`、`审计员`的用户名和邮箱
>
> ​				设置`会议管理员`的文件删除和下载权限  `filePrivilegeArray`

​		

```apl
POST localhost:8088/userservice/user/update
```

参数类型：form-data



##### 8、设置普通用户为会议管理员

```apl
PUT localhost:8088/userservice/general-user/meeting-admin/{userId}
```



9、修改密码

```apl
PUT localhost:8088/userservice/user/password
```

form-data

| token  | eyJhbGciOiJSUzI1NiJ9.eyJkZXB0TmFtZSI6bnVsbCwic3ViIjoiY2V0Y2Nsb3VkIiwicm9sZUlkIjo2NzgxMjgxMTk5MjUyODMyMjU4LCJkZXB0SWQiOm51bGwsInBob3RvIjpudWxsLCJ1c2VyTmFtZSI6ImF1ZGl0b3IwMSIsInBob25lIjoiIiwicm9sZUZsYWciOjMsInB3ZFZlcmlmeUNvZGUiOi0xLCJuYW1lIjpudWxsLCJpZCI6Njc4MjQ0MDAzNDAwOTA4ODAwMCwiZXhwIjoxNjE3NzA3NDI0LCJpYXQiOjE2MTc2Nzc0MjQsImp0aSI6ImYzMzRiMDRhLWExMTQtNDA5ZS1iZDEzLWIwN2IxODBlYTJkMCIsInB3ZFZlcmlmeU1zZyI6InN1Y2Nlc3MifQ.IvOOeoX5-NPsV8sguFIav2KySmIxIPi0tLzuqAxXnzPgqeY56aAJjINQmLtIZx6_t7TA0fvFHT4deOSH16-uOMigEP2jcZKuMK5KN1yygTV2eYA8q-ldm1KLenapGy97pcL-olwZtybHDX5Q-F9Pie08D8854F-nBTAnLLwSJac |
| ------ | ------------------------------------------------------------ |
| pwd    | yuh21FR3rBak8Ciw7CG2ew                                       |
| newpwd | mIxIPi0tLzuqAxCiw7CG2ew                                      |

| 50003 | 原始密码错误                                                 |
| ----- | ------------------------------------------------------------ |
| 50006 | 普通用户不允许修改密码                                       |
| 41001 | 口令长度低于安全要求，需要修改口令                           |
| 41006 | 口令不符合要求，小写英文字母、数字、和特殊字符中2者以上任意组合，特殊符号包括: ~!@#$%^&*" |

